<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Test_Execute.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "doctest.h"
#include "../Main/Scheduler.h"

<span style = "background-color:#dfd">TEST_CASE("Scheduler::execute") {</span>
	Scheduler scheduler;
<span style = "background-color:#dfd">	SUBCASE("Scheduler::execute - Successful Execution of Critical Task") {
		shared_ptr&lt;Task&gt; criticalTask(new Task(Scheduler::taskIds++, PrioritiesLevel::CRITICAL, 2));</span>

<span style = "background-color:#dfd">		scheduler.insertTask(criticalTask);</span>

<span style = "background-color:#dfd">		std::thread schedulerThread(&amp;RealTimeScheduler::realTimeSchedulerFunction, &amp;scheduler.getRealTimeScheduler());
		std::this_thread::sleep_for(std::chrono::seconds(3));</span>

<span style = "background-color:#dfd">		CHECK_EQ(criticalTask-&gt;getStatus(), TaskStatus::COMPLETED);</span>

<span style = "background-color:#dfd">		schedulerThread.detach();
	}
	SUBCASE("Scheduler::execute - Preemption of Non-Critical Task") {
		shared_ptr&lt;Task&gt; higherPriorityTask(new Task(Scheduler::taskIds++, PrioritiesLevel::HIGHER, 5));
		shared_ptr&lt;Task&gt; criticalTask(new Task(Scheduler::taskIds++, PrioritiesLevel::CRITICAL, 2));</span>

		// Insert tasks into the scheduler
<span style = "background-color:#dfd">		scheduler.insertTask(higherPriorityTask);
		scheduler.insertTask(criticalTask);</span>

		// Create a thread to execute tasks in the scheduler
<span style = "background-color:#dfd">		std::thread schedulerThread([&amp;scheduler, higherPriorityTask, criticalTask]() {</span>
			// Simulate execution of tasks
<span style = "background-color:#dfd">			scheduler.execute(higherPriorityTask); // Start executing the non-critical task
			scheduler.execute(criticalTask);       // Then, execute the critical task
			});</span>

		// Allow time for tasks to be processed
<span style = "background-color:#dfd">		std::this_thread::sleep_for(std::chrono::seconds(7));</span>

		// Check if the higher priority task was preempted and critical task completed
<span style = "background-color:#dfd">		CHECK_EQ(higherPriorityTask-&gt;getStatus(), TaskStatus::SUSPENDED);
		CHECK_EQ(criticalTask-&gt;getStatus(), TaskStatus::COMPLETED);</span>

		// Ensure the scheduler thread finishes
<span style = "background-color:#dfd">		schedulerThread.join();
	}</span>

<span style = "background-color:#dfd">	SUBCASE("Scheduler::execute - Boundary Condition: Minimum Running Time") {
		shared_ptr&lt;Task&gt; minTimeTask(new Task(Scheduler::taskIds++, PrioritiesLevel::CRITICAL, 0));</span>

<span style = "background-color:#dfd">		scheduler.insertTask(minTimeTask);</span>

<span style = "background-color:#dfd">		std::thread schedulerThread(&amp;RealTimeScheduler::realTimeSchedulerFunction, &amp;scheduler.getRealTimeScheduler());
		std::this_thread::sleep_for(std::chrono::seconds(1));</span>

<span style = "background-color:#dfd">		CHECK_EQ(minTimeTask-&gt;getStatus(), TaskStatus::COMPLETED);</span>

<span style = "background-color:#dfd">		schedulerThread.detach();
	}
	SUBCASE("Scheduler::execute - Boundary Condition: Maximum Running Time") {</span>
		// Assuming a reasonable maximum running time, like 100 for example
<span style = "background-color:#dfd">		shared_ptr&lt;Task&gt; maxTimeTask(new Task(Scheduler::taskIds++, PrioritiesLevel::CRITICAL, 10));</span>

<span style = "background-color:#dfd">		scheduler.insertTask(maxTimeTask);</span>

<span style = "background-color:#dfd">		std::thread schedulerThread(&amp;RealTimeScheduler::realTimeSchedulerFunction, &amp;scheduler.getRealTimeScheduler());
		std::this_thread::sleep_for(std::chrono::seconds(12)); // Wait until task is completed</span>

<span style = "background-color:#dfd">		CHECK_EQ(maxTimeTask-&gt;getStatus(), TaskStatus::COMPLETED);</span>

<span style = "background-color:#dfd">		schedulerThread.detach();
	}
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>