<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Test_Ordered_Task.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "doctest.h"
#include "../Main/Scheduler.h"
#include "Helper.h"


<span style = "background-color:#dfd">TEST_CASE("OrderedTaskHandler operations") {
    Scheduler s(new ReadFromJSON(), new Utility());
    clearAll(s);</span>

<span style = "background-color:#dfd">    SUBCASE("Adding tasks") {
        auto task1 = std::make_shared&lt;Task&gt;(1,PrioritiesLevel::HIGHER, 10, true);
        auto task2 = std::make_shared&lt;Task&gt;(2,PrioritiesLevel::HIGHER, 20, true);</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().addOrderedtask(task1);
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == task1);
        CHECK(s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.size() == 1);
        CHECK(s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.front() == task1);</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().addOrderedtask(task2);
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == task1);
        CHECK(s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.size() == 1);//the task didn't enter the wrr queue yet</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().popOrderedTask();
        s.getOrderedTaskHandler().popOrderedTask();
        s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.pop();
        s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.pop();</span>

<span style = "background-color:#dfd">    }</span>

<span style = "background-color:#dfd">    SUBCASE("Popping tasks") {
        auto task1 = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::HIGHER, 10, true);
        auto task2 = std::make_shared&lt;Task&gt;(2, PrioritiesLevel::HIGHER, 20, true);</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().addOrderedtask(task1);
        s.getOrderedTaskHandler().addOrderedtask(task2);</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().popOrderedTask();
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == task2);
        CHECK(s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.size() == 2);</span>

<span style = "background-color:#dfd">        s.getOrderedTaskHandler().popOrderedTask();
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == nullptr);
        CHECK(s.getWrrQueuesScheduler().getWrrQueues()[task1-&gt;getPriority()].queue.size() == 2);
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Execute Ordered Task") {
        auto task1 = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::HIGHER, 3, true);
        s.execute(task1);
        std::this_thread::sleep_for(std::chrono::seconds(4));
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == nullptr);
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Insert Two Ordered Task") {
        auto task1 = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::HIGHER, 10, true);
        auto task2 = std::make_shared&lt;Task&gt;(2, PrioritiesLevel::HIGHER, 20, true);
        s.insertTask(task1);
        s.insertTask(task2);</span>

<span style = "background-color:#dfd">        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == task1);
        s.getOrderedTaskHandler().popOrderedTask();
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == task2);
        s.getOrderedTaskHandler().popOrderedTask();
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Empty queue behavior") {
        CHECK(s.getOrderedTaskHandler().frontOrderedTask() == nullptr);</span>

<span style = "background-color:#dfd">        CHECK_NOTHROW(s.getOrderedTaskHandler().popOrderedTask());  // Should not crash
    }</span>


<span style = "background-color:#dfd">}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>