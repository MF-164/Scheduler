<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>IterativeTaskHandler.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
#include "IterativeTaskHandler.h"
#include &lt;chrono&gt;
#include "Scheduler.h"
#include "IterativeTask.h"

/**
 * @brief Pushes an iterative task onto the heap
 *
 * @param iterativeTask The iterative task to be pushed onto the heap
 */
void IterativeTaskHandler::pushIterativeTask(shared_ptr&lt;IterativeTask&gt; iterativeTask)
<span style = "background-color:#dfd">{</span>
	// Check if there are iterations remaining for the task
<span style = "background-color:#dfd">	int iterationsRemaining = iterativeTask-&gt;getIterationsRemaining();
	if (iterationsRemaining &lt;= 1) {
		return;</span>
	}

	// Decrease the remaining iterations count
<span style = "background-color:#dfd">	iterativeTask-&gt;decreaseIterationsRemaining();</span>

	// Calculate the time to wait before executing the task again
<span style = "background-color:#dfd">	auto systemTime = std::chrono::system_clock::now();
	std::time_t currentTime_t = std::chrono::system_clock::to_time_t(systemTime);
	int waitTime = iterativeTask-&gt;getExecutionInterval() + currentTime_t;
	iterativeTask-&gt;setWaitTime(waitTime);</span>

	// Add the task to the min heap
<span style = "background-color:#dfd">	minHeap.emplace(iterativeTask);
	spdlog::info(Logger::LoggerInfo::PUSH_ITERATIVE_TASK_TO_HEAP, iterativeTask-&gt;getId(), iterativeTask-&gt;getIterationsRemaining());
}</span>

/**
 * @brief Pops the top task from the heap
 *
 * @return The top task popped from the heap
 */
shared_ptr&lt;IterativeTask&gt; IterativeTaskHandler::popIterativeTask()
<span style = "background-color:#dfd">{
	if (isEmpty())
		throw "can't pop from empty heap";</span>

<span style = "background-color:#dfd">	shared_ptr&lt;IterativeTask&gt; topTask = minHeap.top();
	minHeap.pop();
	spdlog::info(Logger::LoggerInfo::POP_ITERATIVE_TASK_FROM_HEAP, topTask-&gt;getId());</span>

	// Set the running time of the task
<span style = "background-color:#dfd">	topTask-&gt;setRunningTime(topTask-&gt;getRunTime());</span>

<span style = "background-color:#dfd">	return topTask;
}</span>

/**
 * @brief Checks the current time and insert task if their wait time has elapsed
 */
void IterativeTaskHandler::checkTime()
<span style = "background-color:#dfd">{
	while (true) {
		auto systemTime = std::chrono::system_clock::now();
		std::time_t currentTime_t = std::chrono::system_clock::to_time_t(systemTime);</span>

		// Check if the heap is not empty
<span style = "background-color:#dfd">		if (!this-&gt;isEmpty()) {
			std::time_t waitTime = minHeap.top()-&gt;getWaitTime();</span>

			// If the current time is greater than or equal to the task's wait time, insert the task again
<span style = "background-color:#dfd">			if (currentTime_t &gt;= waitTime) {
				Scheduler::insertTask(dynamic_pointer_cast&lt;Task&gt;(popIterativeTask()));</span>
			}
		}

<span style = "background-color:#dfd">		std::this_thread::sleep_for(std::chrono::seconds(1));
	}</span>
<span style = "background-color:#fdd">}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>