<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Test_Long_task.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
//#include "doctest.h"
//#include "../Main/Task.h"
//#include "../Main/Scheduler.h"
//#include "../Main/LongTaskHandler.h"
//
//TEST_CASE("Testing LongTaskHandler functionality") {
//    //Clear the static variables before each test
//    LongTaskHandler::setSumOfAllSeconds(0);
//    LongTaskHandler::setNumOfSeconds(0);
//    LongTaskHandler::setAverageLength(0.0);
//
//    SUBCASE("Test average length calculation") {
//        // Setup
//        LongTaskHandler::addSumOfAllSeconds(30);
//        Scheduler::totalRunningTask = 10;
//        LongTaskHandler::calculateAverageLength();
//
//        // Verify average length
//        CHECK(LongTaskHandler::getAverageLength() == doctest::Approx(3.0));
//    }
//
//    SUBCASE("Test haveToSuspendLongTask function") {
//        // Setup
//        auto task1 = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::HIGHER, 10);
//        auto task2 = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::CRITICAL, 10);
//
//        //case where task1 should not be suspended because the totalRunningTask is 1.
//        Scheduler::totalRunningTask = 1;
//        CHECK_FALSE(LongTaskHandler::haveToSuspendLongTask(task1));
//
//        //case where task2 should not be suspended because it's the only one rt task.
//        Scheduler::totalRunningTask = 2;
//        CHECK_FALSE(LongTaskHandler::haveToSuspendLongTask(task2));
//
//
//        LongTaskHandler::addSumOfAllSeconds(30);
//        Scheduler::totalRunningTask = 5;
//        LongTaskHandler::setAverageLength(5.0);
//
//        // Case where task should not be suspended because of the calculation of the seconds.
//        CHECK_FALSE(LongTaskHandler::haveToSuspendLongTask(task1));
//
//        // Adjust to make it suspend
//        LongTaskHandler::setNumOfSeconds(6);
//        CHECK(LongTaskHandler::haveToSuspendLongTask(task1));
//    }
//
//    SUBCASE("Test stopLongTask function") {
//        // Setup
//        auto task = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::MIDDLE, 10);
//        Scheduler::totalRunningTask = 1;
//        Scheduler::addTaskToItsQueue(task);  // Add to queue first
//
//        // Stop the long task
//        LongTaskHandler::stopLongTask(task);
//
//        // Verify status
//        CHECK(task-&gt;getStatus() == TaskStatus::SUSPENDED);
//        // Optionally verify that the task was moved in the queue
//        // This would require checking the actual contents of the scheduler's queue
//    }
//}
#include "doctest.h"
#include "../Main/Task.h"
#include "../Main/Scheduler.h"
#include "../Main/LongTaskHandler.h"

<span style = "background-color:#dfd">TEST_CASE("Extended LongTaskHandler Tests") {</span>
    // Clear static variables before each test
<span style = "background-color:#dfd">    LongTaskHandler::setSumOfAllSeconds(0);
    LongTaskHandler::setNumOfSeconds(0);
    LongTaskHandler::setAverageLength(0.0);</span>

<span style = "background-color:#dfd">    SUBCASE("Test addSumOfAllSeconds and increaseNumOfSeconds") {
        LongTaskHandler::addSumOfAllSeconds(10);
        CHECK(LongTaskHandler::getSumOfAllSeconds() == 10);</span>

<span style = "background-color:#dfd">        LongTaskHandler::increaseNumOfSeconds();
        CHECK(LongTaskHandler::getNumOfSeconds() == 1);</span>

<span style = "background-color:#dfd">        LongTaskHandler::increaseNumOfSeconds();
        CHECK(LongTaskHandler::getNumOfSeconds() == 2);
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Test setters and getters") {
        LongTaskHandler::setSumOfAllSeconds(100);
        CHECK(LongTaskHandler::getSumOfAllSeconds() == 100);</span>

<span style = "background-color:#dfd">        LongTaskHandler::setNumOfSeconds(5);
        CHECK(LongTaskHandler::getNumOfSeconds() == 5);</span>

<span style = "background-color:#dfd">        LongTaskHandler::setAverageLength(20.5);
        CHECK(LongTaskHandler::getAverageLength() == doctest::Approx(20.5));
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Test haveToSuspendLongTask with edge cases") {
        auto task = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::LOWER, 10);</span>

        // Edge case: totalRunningTask is 0
<span style = "background-color:#dfd">        Scheduler::totalRunningTask = 0;
        CHECK_FALSE(LongTaskHandler::haveToSuspendLongTask(task));</span>

        // Edge case: numOfSeconds equals averageLength
<span style = "background-color:#dfd">        Scheduler::totalRunningTask = 2;
        LongTaskHandler::setNumOfSeconds(10);
        LongTaskHandler::setAverageLength(10.0);
        CHECK_FALSE(LongTaskHandler::haveToSuspendLongTask(task));</span>

        // Edge case: very large numOfSeconds and averageLength
<span style = "background-color:#dfd">        LongTaskHandler::setNumOfSeconds(1000000);
        LongTaskHandler::setAverageLength(999999.9);
        CHECK(LongTaskHandler::haveToSuspendLongTask(task));
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Test calculateAverageLength with edge cases") {</span>
        // Edge case: totalRunningTask is 0
<span style = "background-color:#dfd">        Scheduler::totalRunningTask = 0;
        LongTaskHandler::setSumOfAllSeconds(100);
        LongTaskHandler::calculateAverageLength();
        CHECK(LongTaskHandler::getAverageLength() == doctest::Approx(0.0));</span>

        // Edge case: very large sumOfAllSeconds
<span style = "background-color:#dfd">        Scheduler::totalRunningTask = 1;
        LongTaskHandler::setSumOfAllSeconds(1000000000);
        LongTaskHandler::calculateAverageLength();
        CHECK(LongTaskHandler::getAverageLength() == doctest::Approx(1000000000.0));
    }</span>

<span style = "background-color:#dfd">    SUBCASE("Test stopLongTask with different task priorities") {
        auto lowPriorityTask = std::make_shared&lt;Task&gt;(1, PrioritiesLevel::LOWER, 10);
        auto highPriorityTask = std::make_shared&lt;Task&gt;(2, PrioritiesLevel::HIGHER, 10);
        auto criticalTask = std::make_shared&lt;Task&gt;(3, PrioritiesLevel::CRITICAL, 10);</span>

<span style = "background-color:#dfd">        Scheduler::addTaskToItsQueue(lowPriorityTask);
        Scheduler::addTaskToItsQueue(highPriorityTask);
        Scheduler::addTaskToItsQueue(criticalTask);</span>

<span style = "background-color:#dfd">        LongTaskHandler::stopLongTask(lowPriorityTask);
        CHECK(lowPriorityTask-&gt;getStatus() == TaskStatus::SUSPENDED);</span>

<span style = "background-color:#dfd">        LongTaskHandler::stopLongTask(highPriorityTask);
        CHECK(highPriorityTask-&gt;getStatus() == TaskStatus::SUSPENDED);</span>

<span style = "background-color:#dfd">        LongTaskHandler::stopLongTask(criticalTask);
        CHECK(criticalTask-&gt;getStatus() == TaskStatus::SUSPENDED);
    }
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>